(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,41408,e=>{"use strict";var t=e.i(45042),a=e.i(61808),o=e.i(7479),r=e.i(97817),n=e.i(38706);function s({children:e}){let{isAuthenticated:s,isLoading:l}=(0,a.useAuth)(),i=(0,o.useRouter)();return((0,r.useEffect)(()=>{l||s||i.push("/")},[s,l,i]),l)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):s?(0,t.jsx)(t.Fragment,{children:e}):null}e.s(["ProtectedRoute",()=>s,"default",()=>s])},1508,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return o}});let o=e=>{}},95876,e=>{"use strict";var t=e.i(45042),a=e.i(18846);function o({className:e,type:o,...r}){return(0,t.jsx)("input",{type:o,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...r})}e.s(["Input",()=>o])},38706,e=>{"use strict";let t=(0,e.i(80329).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],38706)},45634,e=>{"use strict";var t=e.i(45042),a=e.i(97817),o=e.i(69194),r=e.i(74536),n=e.i(47206),s=e.i(73261),l=e.i(36640),i=e.i(93474),d=e.i(48298),c=e.i(49572),m="Checkbox",[u,p]=(0,r.createContextScope)(m),[h,g]=u(m),f=a.forwardRef((e,r)=>{let{__scopeCheckbox:l,name:i,checked:d,defaultChecked:m,required:u,disabled:p,value:g="on",onCheckedChange:f,form:v,...y}=e,[I,N]=a.useState(null),j=(0,o.useComposedRefs)(r,e=>N(e)),A=a.useRef(!1),C=!I||v||!!I.closest("form"),[E=!1,k]=(0,s.useControllableState)({prop:d,defaultProp:m,onChange:f}),$=a.useRef(E);return a.useEffect(()=>{let e=I?.form;if(e){let t=()=>k($.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[I,k]),(0,t.jsxs)(h,{scope:l,state:E,disabled:p,children:[(0,t.jsx)(c.Primitive.button,{type:"button",role:"checkbox","aria-checked":w(E)?"mixed":E,"aria-required":u,"data-state":b(E),"data-disabled":p?"":void 0,disabled:p,value:g,...y,ref:j,onKeyDown:(0,n.composeEventHandlers)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,n.composeEventHandlers)(e.onClick,e=>{k(e=>!!w(e)||!e),C&&(A.current=e.isPropagationStopped(),A.current||e.stopPropagation())})}),C&&(0,t.jsx)(x,{control:I,bubbles:!A.current,name:i,value:g,checked:E,required:u,disabled:p,form:v,style:{transform:"translateX(-100%)"},defaultChecked:!w(m)&&m})]})});f.displayName=m;var v="CheckboxIndicator",y=a.forwardRef((e,a)=>{let{__scopeCheckbox:o,forceMount:r,...n}=e,s=g(v,o);return(0,t.jsx)(d.Presence,{present:r||w(s.state)||!0===s.state,children:(0,t.jsx)(c.Primitive.span,{"data-state":b(s.state),"data-disabled":s.disabled?"":void 0,...n,ref:a,style:{pointerEvents:"none",...e.style}})})});y.displayName=v;var x=e=>{let{control:o,checked:r,bubbles:n=!0,defaultChecked:s,...d}=e,c=a.useRef(null),m=(0,l.usePrevious)(r),u=(0,i.useSize)(o);a.useEffect(()=>{let e=c.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(m!==r&&t){let a=new Event("click",{bubbles:n});e.indeterminate=w(r),t.call(e,!w(r)&&r),e.dispatchEvent(a)}},[m,r,n]);let p=a.useRef(!w(r)&&r);return(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s??p.current,...d,tabIndex:-1,ref:c,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function w(e){return"indeterminate"===e}function b(e){return w(e)?"indeterminate":e?"checked":"unchecked"}var I=e.i(48583),N=e.i(18846);function j({className:e,...a}){return(0,t.jsx)(f,{"data-slot":"checkbox",className:(0,N.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:(0,t.jsx)(y,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,t.jsx)(I.CheckIcon,{className:"size-3.5"})})})}e.s(["Checkbox",()=>j],45634)},490,e=>{"use strict";var t=e.i(39403);function a(e){return{id:e.componentId,componentId:e.componentId,englishName:e.englishName,tamilName:e.tamilName,componentType:e.componentTypeEnglish,componentTypeEnglish:e.componentTypeEnglish,remark:e.remark,createdDate:new Date(e.createdAt).toISOString().split("T")[0],createdBy:e.createdBy,fieldsCount:0}}let o=new class{async getAllComponents(){try{console.log("[v0] Fetching components from API...");let e=await t.apiClient.get("/api/v1/components");if(e.success&&e.data)return console.log("[v0] Components fetched successfully:",e.data.length),e.data.map(a);return console.log("[v0] API response unsuccessful, returning empty array"),[]}catch(e){return console.error("[v0] Error fetching components:",e),[]}}async createComponent(e){try{console.log("[v0] Creating component:",e);let o=await t.apiClient.post("/api/v1/components",e);if(o.success&&o.data)return console.log("[v0] Component created successfully:",o.data.componentId),a(o.data);throw Error("Failed to create component")}catch(e){throw console.error("[v0] Error creating component:",e),e}}async getComponentById(e){try{console.log("[v0] Fetching component by ID:",e);let o=await t.apiClient.get(`/api/v1/components/${e}`);if(o.success&&o.data)return console.log("[v0] Component fetched successfully:",o.data.componentId),a(o.data);return null}catch(e){return console.error("[v0] Error fetching component:",e),null}}async updateComponent(e,o){try{console.log("[v0] Updating component:",e,o);let r=await t.apiClient.put(`/api/v1/components/${e}`,o);if(r.success&&r.data)return console.log("[v0] Component updated successfully:",r.data.componentId),a(r.data);throw Error("Failed to update component")}catch(e){throw console.error("[v0] Error updating component:",e),e}}async deleteComponent(e){try{if(console.log("[v0] Deleting component:",e),(await t.apiClient.delete(`/api/v1/components/${e}`)).success)return void console.log("[v0] Component deleted successfully:",e);throw Error("Failed to delete component")}catch(e){throw console.error("[v0] Error deleting component:",e),e}}};e.s(["COMPONENT_TYPES",0,["Infrastructure","Individual"],"componentService",0,o])},20648,e=>{"use strict";var t=e.i(50038);e.s(["X",()=>t.default])},57407,e=>{"use strict";let t=(0,e.i(80329).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],57407)},79230,e=>{"use strict";var t=e.i(39403);function a(e){return{_id:e._id,id:e.schemeId,schemeId:e.schemeId,englishName:e.englishName,tamilName:e.tamilName,englishAbbreviation:e.englishAbbreviation,remark:e.remark,createdAt:e.createdAt,updatedAt:e.updatedAt,createdBy:e.createdBy?.name||e.createdBy||"Unknown",updatedBy:e.updatedBy?.name||e.updatedBy}}let o=new class{API_BASE="/api/v1/schemes";async getAllSchemes(){try{console.log("[v0] Fetching all schemes from API");let e=await t.apiClient.get(this.API_BASE);if(e.success&&e.data)return console.log("[v0] Successfully fetched schemes:",e.data),e.data.map(a);throw console.error("[v0] Failed to fetch schemes:",e.error),Error(e.error||"Failed to fetch schemes")}catch(e){throw console.error("[v0] Error in getAllSchemes:",e),e}}async createScheme(e){try{console.log("[v0] Creating scheme with data:",e);let o=await t.apiClient.post(this.API_BASE,e);if(o.success&&o.data)return console.log("[v0] Successfully created scheme:",o.data),a(o.data);throw console.error("[v0] Failed to create scheme:",o.error),Error(o.error||"Failed to create scheme")}catch(e){throw console.error("[v0] Error in createScheme:",e),e}}async getSchemeById(e){try{console.log("[v0] Fetching scheme by ID:",e);let o=await t.apiClient.get(`${this.API_BASE}/${e}`);if(o.success&&o.data)return console.log("[v0] Successfully fetched scheme:",o.data),a(o.data);return console.error("[v0] Failed to fetch scheme:",o.error),null}catch(e){return console.error("[v0] Error in getSchemeById:",e),null}}async updateScheme(e,o){try{console.log("[v0] Updating scheme:",e,"with data:",o);let r=await t.apiClient.put(`${this.API_BASE}/${e}`,o);if(r.success&&r.data)return console.log("[v0] Successfully updated scheme:",r.data),a(r.data);throw console.error("[v0] Failed to update scheme:",r.error),Error(r.error||"Failed to update scheme")}catch(e){throw console.error("[v0] Error in updateScheme:",e),e}}async deleteScheme(e){try{console.log("[v0] Deleting scheme:",e);let a=await t.apiClient.delete(`${this.API_BASE}/${e}`);if(a.success)console.log("[v0] Successfully deleted scheme:",e);else throw console.error("[v0] Failed to delete scheme:",a.error),Error(a.error||"Failed to delete scheme")}catch(e){throw console.error("[v0] Error in deleteScheme:",e),e}}};e.s(["schemeService",0,o])},64831,e=>{"use strict";let t=(0,e.i(80329).default)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],64831)},75146,e=>{"use strict";var t=e.i(39403);let a=new class{mapApiResponseToTemplateField(e){return{id:e._id,group:e.group,name:e.name,dataType:e.dataType,isRequired:e.isRequired,options:e.options||[],validation:e.validation,isDefault:e.isDefault,order:e.order,componentId:e.componentId||void 0,category:e.category,createdBy:e.createdBy,isSubForm:e.isSubForm||!1,lov:e.lov}}async getFieldsByComponent(e){try{let a=await t.apiClient.get(`/api/v1/fields/component/${e}`);console.log(`[v0] API response for component ${e}:`,a);let o=[];return Array.isArray(a)?o=a:a&&Array.isArray(a.data)||a&&a.success&&Array.isArray(a.data)?o=a.data:a&&a.data&&a.data.success&&Array.isArray(a.data.data)&&(o=a.data.data),console.log("[v0] Extracted fields array:",o),o.map(e=>{let t=this.mapApiResponseToTemplateField(e);return"dropdown"===e.dataType&&e.options&&(console.log(`[v0] Field ${e.name} options from API:`,e.options),console.log(`[v0] Field ${e.name} mapped options:`,t.options)),t})}catch(e){return console.error("Failed to fetch fields by component:",e),[]}}async createField(e){try{return await t.apiClient.post("/api/v1/fields",e)}catch(e){throw console.error("Failed to create field:",e),e}}async updateField(e,a,o){try{return await t.apiClient.patch(`/api/v1/fields/${a}`,o)}catch(e){throw console.error("Failed to update field:",e),e}}async deleteField(e,a){try{return await t.apiClient.delete(`/api/v1/fields/${a}`),!0}catch(e){return console.error("Failed to delete field:",e),!1}}async getNumberFields(){try{let e=await t.apiClient.get("/api/v1/fields/number-fields");console.log("[v0] Number fields API response:",e);let a=[];return Array.isArray(e)?a=e:e&&Array.isArray(e.data)||e&&e.success&&Array.isArray(e.data)?a=e.data:e&&e.data&&e.data.success&&Array.isArray(e.data.data)&&(a=e.data.data),console.log("[v0] Extracted number fields array:",a),a.map(e=>({id:e.name,name:e.name,dataType:"number"}))}catch(e){return console.error("Failed to fetch number fields:",e),[]}}};e.s(["templateService",0,a])},16096,e=>{"use strict";var t=e.i(45042),a=e.i(97817),o=e.i(79230),r=e.i(490),n=e.i(75146),s=e.i(86997);let l=new class{baseUrl="http://127.0.0.1:4000";async makeRequest(e){try{console.log(`[v0] Making master API request to: ${this.baseUrl}${e}`);let t={"Content-Type":"application/json"},a=s.TokenStorage.getAccessToken(),o=s.TokenStorage.getRefreshToken();a&&(t.Authorization=`Bearer ${a}`),o&&(t["x-refresh-token"]=o);let r=await fetch(`${this.baseUrl}${e}`,{headers:t});if(console.log(`[v0] Master API response status: ${r.status}`),!r.ok)throw Error(`HTTP error! status: ${r.status}`);let n=await r.json();console.log("[v0] Master API response data:",n);let l=[];return l=Array.isArray(n)?n:n.success&&Array.isArray(n.data)||n.data&&Array.isArray(n.data)?n.data:[],console.log("[v0] Processed master API result:",l),l}catch(t){return console.error(`[v0] Failed to fetch ${e}:`,t),[]}}async getZones(){return console.log("[v0] Fetching zones from master API"),this.makeRequest("/api/v1/zones")}async getDistricts(e){console.log(`[v0] Fetching districts from master API, zoneId: ${e}`);let t=e?`/api/v1/districts/zone/${e}`:"/api/v1/districts";return this.makeRequest(t)}async getTownPanchayats(e){console.log(`[v0] Fetching town panchayats from master API, districtId: ${e}`);let t=e?`/api/v1/town-panchayats/district/${e}`:"/api/v1/town-panchayats";return this.makeRequest(t)}async getWards(e){console.log(`[v0] Fetching wards from master API, townPanchayatId: ${e}`);let t=e?`/api/v1/wards/townPanchayat/${e}`:"/api/v1/wards";return this.makeRequest(t)}async getAgencies(){return this.makeRequest("/api/lov/agencies")}async getRoadTypesEnglish(){return this.makeRequest("/api/lov/roadTypesEnglish")}async getRoadTypesTamil(){return this.makeRequest("/api/lov/roadTypesTamil")}async getDurationUnits(){return this.makeRequest("/api/lov/durationUnits")}async getStages(){return this.makeRequest("/api/lov/stages")}async getContractors(){return this.makeRequest("/api/lov/contractors")}async getContractorNames(e){let t=e?`/api/lov/contractorNames?gstNo=${e}`:"/api/lov/contractorNames";return this.makeRequest(t)}};var i=e.i(61808),d=e.i(7479),c=e.i(53790),m=e.i(95876),u=e.i(75987),p=e.i(45634),h=e.i(38706),g=e.i(64831),f=e.i(80329);let v=(0,f.default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),y=(0,f.default)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var x=e.i(57407),w=e.i(20648);function b(){let{user:s,isLoading:f}=(0,i.useAuth)(),b=(0,d.useRouter)(),[I,N]=(0,a.useState)([]),[j,A]=(0,a.useState)([]),[C,E]=(0,a.useState)([]),[k,$]=(0,a.useState)(""),[F,S]=(0,a.useState)(""),[P,T]=(0,a.useState)({}),[L,B]=(0,a.useState)(!1),[R,D]=(0,a.useState)({}),[O,q]=(0,a.useState)({}),[z,U]=(0,a.useState)({}),[M,V]=(0,a.useState)({}),[_,W]=(0,a.useState)({}),[H,G]=(0,a.useState)({}),[X,Y]=(0,a.useState)(!1),[K,J]=(0,a.useState)(null),Z=(0,a.useRef)(null),Q=(0,a.useRef)(null),ee=(0,a.useRef)(null);(0,a.useEffect)(()=>{!f&&s&&(et(),ea())},[f,s]),(0,a.useEffect)(()=>{F&&(eo(F),T({}),q({}))},[F]);let et=async()=>{try{console.log("[v0] Loading schemes using scheme service");let e=await o.schemeService.getAllSchemes();N(e),console.log("[v0] Loaded schemes:",e.length)}catch(e){console.error("Failed to load schemes:",e),N([])}},ea=async()=>{try{console.log("[v0] Loading components using component service");let e=await r.componentService.getAllComponents();A(e),console.log("[v0] Loaded components:",e.length)}catch(e){console.error("Failed to load components:",e),A([])}},eo=async e=>{try{console.log("[v0] Loading fields for component:",e);let t=await n.templateService.getFieldsByComponent(e);console.log("[v0] Raw API response:",JSON.stringify(t,null,2));let a=[];Array.isArray(t)?(console.log("[v0] Response is direct array, mapping fields..."),a=t.map((e,t)=>(console.log(`[v0] Field ${t}: ${e.name}, options:`,e.options),{...e,fieldId:e.id||e._id||e.fieldId,_id:e.id||e._id,options:e.options||[]}))):t&&t.success&&Array.isArray(t.data)&&(console.log("[v0] Response has nested data array, mapping fields..."),a=t.data.map((e,t)=>(console.log(`[v0] Field ${t}: ${e.name}, options:`,e.options),{...e,fieldId:e.id||e._id||e.fieldId,_id:e.id||e._id,options:e.options||[]}))),console.log("[v0] Fields after mapping:"),a.forEach((e,t)=>{"dropdown"===e.dataType&&console.log(`[v0] Dropdown field ${e.name}:`,{hasLOV:!!e.lov,lovAPI:e.lov?.api,hasOptions:!!(e.options&&Array.isArray(e.options)&&e.options.length>0),optionsLength:e.options?.length||0,sampleOptions:e.options?.slice(0,2)})}),a.sort((e,t)=>e.order-t.order),E(a),console.log("[v0] Fields with LOV configurations:",a.filter(e=>e.lov).map(e=>({name:e.name,lov:e.lov}))),console.log("[v0] Fields with static options:",a.filter(e=>e.options&&Array.isArray(e.options)&&e.options.length>0).map(e=>({name:e.name,optionsCount:e.options?.length||0,sampleOptions:e.options?.slice(0,2)}))),er(a),console.log("[v0] Loaded fields:",a.length)}catch(e){console.error("Failed to load fields:",e),E([])}},er=async e=>{let t={};for(let a of(console.log(`[v0] Starting loadDropdownOptions with ${e.length} fields`),e))if(console.log(`[v0] Processing field: ${a.name}, dataType: ${a.dataType}, hasLOV: ${!!a.lov}, LOV API: ${a.lov?.api||"none"}, hasStaticOptions: ${!!(a.options&&Array.isArray(a.options)&&a.options.length>0)}, optionsLength: ${a.options?.length||0}`),a.options&&Array.isArray(a.options)&&a.options.length>0)console.log(`[v0] Using static options for field: ${a.name}, options:`,a.options),t[a.fieldId]=a.options.map((e,t)=>"object"==typeof e&&(e.englishName||e.tamilName||e.nameEnglish||e.nameTamil)?{...e,id:e.id||e.englishName||e.nameEnglish||`option-${t}`,value:e.englishName||e.nameEnglish||e.value||`option-${t}`,nameEnglish:e.englishName||e.nameEnglish||e.value||`option-${t}`,nameTamil:e.tamilName||e.nameTamil||"",englishName:e.englishName||e.nameEnglish||e.value||`option-${t}`,tamilName:e.tamilName||e.nameTamil||""}:"string"==typeof e?{nameEnglish:e,nameTamil:"",englishName:e,tamilName:"",id:e,value:e}:{nameEnglish:String(e),nameTamil:"",englishName:String(e),tamilName:"",id:String(e),value:String(e)}),console.log(`[v0] Mapped ${t[a.fieldId].length} static options for ${a.name}:`,t[a.fieldId]);else if(a.lov&&a.lov.api&&"dropdown"===a.dataType)if(a.name.toLowerCase().includes("zone")||a.name.toLowerCase().includes("district")||a.name.toLowerCase().includes("town")||a.name.toLowerCase().includes("panchayat")||a.name.toLowerCase().includes("ward"))try{let e=[];console.log(`[v0] Loading dropdown options for field: ${a.name}, API: ${a.lov.api}`),a.lov.api.includes("zones")||a.name.toLowerCase().includes("zone")?(console.log(`[v0] Calling zones API for field: ${a.name}`),e=await l.getZones()):a.lov.api.includes("districts")||a.name.toLowerCase().includes("district")?a.lov.dependentOn||(console.log(`[v0] Calling districts API for field: ${a.name}`),e=await l.getDistricts()):a.lov.api.includes("townPanchayats")||a.name.toLowerCase().includes("town")||a.name.toLowerCase().includes("panchayat")?a.lov.dependentOn||(console.log(`[v0] Calling town panchayats API for field: ${a.name}`),e=await l.getTownPanchayats()):(a.lov.api.includes("wards")||a.name.toLowerCase().includes("ward"))&&!a.lov.dependentOn&&(console.log(`[v0] Calling wards API for field: ${a.name}`),e=await l.getWards()),console.log(`[v0] Loaded ${e.length} options for ${a.name}:`,e.slice(0,3)),t[a.fieldId]=e}catch(e){console.error(`[v0] Failed to load options for ${a.name}:`,e),t[a.fieldId]=[]}else console.warn(`[v0] Non-geographic dropdown field ${a.name} has LOV API ${a.lov.api} but no static options - using empty array`),t[a.fieldId]=[];else"dropdown"===a.dataType&&(console.log(`[v0] Dropdown field ${a.name} has no LOV configuration or static options`),t[a.fieldId]=[]);console.log("[v0] All dropdown options loaded:",Object.keys(t).map(e=>({fieldId:e,optionsCount:t[e].length}))),q(t)},en=async(e,t)=>{if(!t||"string"==typeof t&&""===t.trim()||""===t)return void console.log("[v0] Parent value is empty, skipping dependent options load");let a=C.filter(t=>t.lov?.dependentOn===e);for(let o of(console.log(`[v0] Loading dependent options for parent: ${e}, value: ${t}`),console.log(`[v0] Found ${a.length} dependent fields:`,a.map(e=>e.name)),a))try{let e=[];switch(o.lov?.api){case"/api/lov/districts":case"/api/v1/districts":console.log(`[v0] Loading districts for zone: ${t}`),e=await l.getDistricts(t);break;case"/api/lov/town-panchayats":case"/api/v1/town-panchayats":console.log(`[v0] Loading town panchayats for district: ${t}`),e=await l.getTownPanchayats(t);break;case"/api/lov/wards":case"/api/v1/wards":console.log(`[v0] Loading wards for town panchayat: ${t}`),e=await l.getWards(t);break;case"/api/lov/contractorNames":console.log(`[v0] Loading contractor names for GST: ${t}`),e=await l.getContractorNames(t);break;default:console.warn(`[v0] No dependent loading logic for API: ${o.lov?.api}`),o.name.toLowerCase().includes("district")?(console.log(`[v0] Inferring districts API call for field: ${o.name}`),e=await l.getDistricts(t)):o.name.toLowerCase().includes("town")||o.name.toLowerCase().includes("panchayat")?(console.log(`[v0] Inferring town panchayats API call for field: ${o.name}`),e=await l.getTownPanchayats(t)):o.name.toLowerCase().includes("ward")&&(console.log(`[v0] Inferring wards API call for field: ${o.name}`),e=await l.getWards(t))}console.log(`[v0] Loaded ${e.length} dependent options for ${o.name}:`,e),q(t=>({...t,[o.fieldId]:e})),T(e=>{let t={...e};return delete t[o.fieldId],t})}catch(e){console.error(`[v0] Failed to load dependent options for ${o.name}:`,e),q(e=>({...e,[o.fieldId]:[]}))}},es=async(e,t)=>{console.log(`[v0] Field changed: ${e} = ${t}`),T(a=>{let o={...a,[e]:t},r=C.find(t=>t.fieldId===e);if(r){if(console.log(`[v0] Field found: ${r.name}, checking for dependents`),C.filter(e=>"calculation"===e.dataType).forEach(e=>{let t=ei(e,o);null!=t&&(console.log(`[v0] Calculated value for ${e.name}: ${t}`),o[e.fieldId]=t)}),r.name.toLowerCase().includes("english")&&r.name.toLowerCase().includes("type")){let a=r.name.replace(/english/i,"Tamil").replace(/English/i,"Tamil"),n=C.find(e=>e.name===a);if(n){let a=(O[e]||[]).find(e=>String(e.englishName||e.nameEnglish||e.name||e.value||e.id||String(e))===String(t));if(a&&(a.tamilName||a.nameTamil)){let e=a.tamilName||a.nameTamil;console.log(`[v0] Auto-mapping Tamil value for ${n.name}: ${e}`),o[n.fieldId]=e}}}let a=C.filter(e=>e.lov?.dependentOn===r.name);console.log(`[v0] Found ${a.length} dependent fields to clear`),a.forEach(e=>{console.log(`[v0] Clearing dependent field: ${e.name}`),delete o[e.fieldId],q(t=>({...t,[e.fieldId]:[]}))});let n=null!=t&&""!==t,s="string"==typeof t&&""!==t.trim(),l="string"!=typeof t&&""!==t;if(n&&(s||l)){let o=(O[e]||[]).find(e=>String(e.zoneId||e.districtId||e.tpId||e.townPanchayatId||e.wardId||e.id||e.value||e._id)===String(t)),n=t;if(o&&(r.name.toLowerCase().includes("zone")?n=o.zoneId||t:r.name.toLowerCase().includes("district")?n=o.districtId||t:(r.name.toLowerCase().includes("town")||r.name.toLowerCase().includes("panchayat"))&&(n=o.tpId||o.townPanchayatId||t),console.log(`[v0] Extracted dependent value for ${r.name}: ${n} (from option:`,o,")")),o){let e=a.map(e=>e.fieldId);T(t=>({...t,...e.reduce((e,t)=>({...e,[t]:null}),{})}))}a.forEach(e=>{en(r.name,n)})}}return o})},el=async t=>{t.preventDefault();let a={};if(C.forEach(e=>{var t;let o,r=(o=!(t=P[e.fieldId])||"string"==typeof t&&""===t.trim()||"string"!=typeof t&&""===t,e.isRequired&&o?`${e.name} is required`:null);r&&(a[e.fieldId]=r)}),D(a),Object.keys(a).length>0)return void console.log("[v0] Form validation failed:",a);B(!0);try{console.log("[v0] Submitting work form:",P);let t=I.find(e=>e.schemeId===k),a=j.find(e=>e.componentId===F);if(!t||!a)throw Error("Selected scheme or component not found");let o={schemeId:k,schemeName:t.englishName,componentId:F,componentName:a.englishName,fieldData:P,createdBy:s?.email||"Unknown User",createdAt:new Date().toISOString()},{workService:r}=await e.A(12034),n=await r.createWork(o);console.log("[v0] Work created successfully:",n),alert("Work created successfully!"),b.push("/dashboard/work")}catch(e){console.error("Failed to create work:",e),alert("Failed to create work. Please try again.")}finally{B(!1)}},ei=(e,t)=>{try{console.log(`[v0] Performing calculation for field: ${e.name}`);let a=e.name.toLowerCase();if(a.includes("balance on fund released")){let e=ed("Fund Released",t),a=ed("Expenditure",t);if(null!==e&&null!==a){let t=e-a;return console.log(`[v0] Balance on Fund Released: ${e} - ${a} = ${t}`),t}}else if(a.includes("balance expenditure on fund released")){let e=ed("Fund Released",t),a=ed("Expenditure",t);if(null!==e&&null!==a){let t=e-a;return console.log(`[v0] Balance Expenditure on fund released: ${e} - ${a} = ${t}`),t}}else if(a.includes("balance expenditure on estimate")){let e=ed("Estimate in Rupees",t),a=ed("Expenditure",t);if(null!==e&&null!==a){let t=e-a;return console.log(`[v0] Balance Expenditure on estimate: ${e} - ${a} = ${t}`),t}}if(e.validation&&e.validation.field1&&e.validation.field2&&e.validation.operator){let a=ed(e.validation.field1,t),o=ed(e.validation.field2,t),r=e.validation.operator;if(null!==a&&null!==o){let e;switch(r){case"+":case"add":e=a+o;break;case"-":case"subtract":e=a-o;break;case"*":case"multiply":e=a*o;break;case"/":case"divide":e=0!==o?a/o:0;break;default:return console.warn(`[v0] Unknown operator: ${r}`),null}return console.log(`[v0] Generic calculation: ${a} ${r} ${o} = ${e}`),e}}return null}catch(t){return console.error(`[v0] Error in calculation for ${e.name}:`,t),null}},ed=(e,t)=>{let a=C.find(t=>t.name===e);if(!a)return console.log(`[v0] Field not found: ${e}`),null;let o=t[a.fieldId],r=Number.parseFloat(o);return isNaN(r)?(console.log(`[v0] Invalid number value for ${e}: ${o}`),null):r},ec=async e=>{try{if(console.log("[v0] Starting camera for field:",e),J(e),Y(!0),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Camera not supported in this browser");console.log("[v0] Requesting camera access...");let t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});if(console.log("[v0] Camera access granted, stream:",t),ee.current=t,Z.current){Z.current.srcObject=t,console.log("[v0] Video element set with stream");let a=Z.current,o=()=>{console.log("[v0] Video ready, dimensions:",a.videoWidth,"x",a.videoHeight),G(t=>({...t,[e]:!0}))};a.addEventListener("loadedmetadata",o),a.addEventListener("canplay",o),a.readyState>=2&&o()}console.log("[v0] Camera modal opened for field:",e)}catch(t){console.error("[v0] Error accessing camera:",t),Y(!1),J(null);let e="Unable to access camera. ";t instanceof Error&&("NotAllowedError"===t.name?e+="Camera permission denied. Please allow camera access and try again.":"NotFoundError"===t.name?e+="No camera found on this device.":"NotSupportedError"===t.name?e+="Camera not supported in this browser.":e+=t.message),alert(e+" Please use file upload instead.")}},em=e=>{console.log("[v0] Stopping camera for field:",e),ee.current&&(ee.current.getTracks().forEach(e=>{console.log("[v0] Stopping track:",e.kind,e.label),e.stop()}),ee.current=null),Y(!1),J(null),G(t=>({...t,[e]:!1}))},eu=(e,t)=>{if(t){let a=URL.createObjectURL(t);V(o=>({...o,[e]:{file:t,preview:a}})),es(e,t)}},ep=e=>{let t=M[e];t?.preview&&URL.revokeObjectURL(t.preview),V(t=>{let a={...t};return delete a[e],a}),es(e,null)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-[#013A65] via-[#0056A3] to-[#013A65] rounded-lg py-3 px-6 text-white shadow-lg border border-[#F3B335]/20",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-white",children:"Create Work"}),(0,t.jsx)("p",{className:"text-white/90 text-sm mt-1",children:"Create a new work entry with dynamic fields based on selected scheme and component"})]}),(0,t.jsxs)(c.Button,{onClick:()=>b.push("/dashboard/work"),size:"sm",className:"bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-9 px-4 text-sm font-medium",children:[(0,t.jsx)(v,{className:"h-4 w-4 mr-1.5"}),"Back to Work List"]})]})}),(0,t.jsx)("div",{className:"bg-white rounded-lg border border-[#F3B335]/20 shadow-sm p-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:["Select Scheme ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(u.Select,{value:k,onValueChange:$,children:[(0,t.jsx)(u.SelectTrigger,{className:"h-12 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white text-base w-full",children:(0,t.jsx)(u.SelectValue,{placeholder:"Choose a scheme..."})}),(0,t.jsx)(u.SelectContent,{children:I.map(e=>(0,t.jsx)(u.SelectItem,{value:e.schemeId,children:e.englishName},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:["Select Component ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(u.Select,{value:F,onValueChange:S,children:[(0,t.jsx)(u.SelectTrigger,{className:"h-12 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white text-base w-full",children:(0,t.jsx)(u.SelectValue,{placeholder:"Choose a component..."})}),(0,t.jsx)(u.SelectContent,{children:j.map(e=>(0,t.jsx)(u.SelectItem,{value:e.componentId,children:e.englishName},e.id))})]})]})]})}),C.length>0&&(0,t.jsxs)("form",{onSubmit:el,className:"space-y-6",children:[Object.entries(C.reduce((e,t)=>{let a=t.group||"General";return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(([e,a])=>(0,t.jsxs)("div",{className:"flex flex-col h-full bg-white rounded-lg border border-[#F3B335]/20 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"flex-shrink-0 p-4 border-b border-[#F3B335]/20",children:(0,t.jsx)("div",{className:"bg-[#F3B335] rounded-lg p-2 w-full",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-[#013A65]",children:e})})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:a.map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:[e.name,e.isRequired&&(0,t.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"dropdown"===e.dataType&&(0,t.jsxs)(u.Select,{value:P[e.fieldId]||"",onValueChange:t=>es(e.fieldId,t),children:[(0,t.jsx)(u.SelectTrigger,{className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",children:(0,t.jsx)(u.SelectValue,{placeholder:`Select ${e.name}`})}),(0,t.jsx)(u.SelectContent,{children:(O[e.fieldId]||[]).map((e,a)=>{let o=e.zoneId||e.districtId||e.tpId||e.townPanchayatId||e.wardId||e.id||e.value||e._id||e,r=e.englishName||e.nameEnglish||e.name||e.label||e.value||String(e);return(0,t.jsx)(u.SelectItem,{value:String(o),children:String(r)},`${o}-${a}`)})})]}),"text"===e.dataType&&(0,t.jsx)(m.Input,{type:"text",value:P[e.fieldId]||"",onChange:t=>es(e.fieldId,t.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:e.isRequired,placeholder:`Enter ${e.name}`}),"number"===e.dataType&&(0,t.jsx)(m.Input,{type:"number",value:P[e.fieldId]||"",onChange:t=>es(e.fieldId,t.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:e.isRequired,placeholder:`Enter ${e.name}`}),"date"===e.dataType&&(0,t.jsx)(m.Input,{type:"date",value:P[e.fieldId]||"",onChange:t=>es(e.fieldId,t.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:e.isRequired}),"financialYearPicker"===e.dataType&&(0,t.jsxs)(u.Select,{value:P[e.fieldId]||"",onValueChange:t=>es(e.fieldId,t),children:[(0,t.jsx)(u.SelectTrigger,{className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",children:(0,t.jsx)(u.SelectValue,{placeholder:"Select Financial Year"})}),(0,t.jsx)(u.SelectContent,{children:(()=>{let e=new Date().getFullYear(),t=[];for(let a=e-4;a<=e;a++)t.push({value:`${a}-${a+1}`,label:`${a}-${a+1}`});return t})().map(e=>(0,t.jsx)(u.SelectItem,{value:e.value,children:e.label},e.value))})]}),"boolean"===e.dataType&&(0,t.jsxs)("div",{className:"flex items-center space-x-3 p-3 border border-[#EDEEF0] rounded-lg bg-[#F8F8F8]",children:[(0,t.jsx)(p.Checkbox,{checked:P[e.fieldId]||!1,onCheckedChange:t=>es(e.fieldId,t),className:"border-[#EDEEF0] data-[state=checked]:bg-[#013A65] data-[state=checked]:border-[#013A65]"}),(0,t.jsx)("span",{className:"text-sm text-[#013A65]",children:"Yes / Enabled"})]}),"textarea"===e.dataType&&(0,t.jsx)("textarea",{value:P[e.fieldId]||"",onChange:t=>es(e.fieldId,t.target.value),className:"min-h-[80px] w-full px-3 py-2 border border-[#EDEEF0] rounded-lg focus:border-[#013A65] focus:ring-[#013A65]/20 focus:outline-none bg-white resize-vertical",required:e.isRequired,placeholder:`Enter ${e.name}`,rows:3}),"file"===e.dataType&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Input,{type:"file",onChange:t=>es(e.fieldId,t.target.files?.[0]),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-[#F3B335]/10 file:text-[#013A65] hover:file:bg-[#F3B335]/20",required:e.isRequired}),(0,t.jsx)("p",{className:"text-xs text-[#013A65]/60",children:"Supported formats: PDF, DOC, DOCX, JPG, PNG (Max: 10MB)"})]}),"geoLocation"===e.dataType&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(m.Input,{type:"text",value:P[e.fieldId]||"",onChange:t=>es(e.fieldId,t.target.value),className:"flex-1 h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white",placeholder:"Latitude, Longitude (e.g., 12.9716, 77.5946)",required:e.isRequired}),(0,t.jsx)(c.Button,{type:"button",onClick:()=>{var t;return t=e.fieldId,void(navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let{latitude:a,longitude:o}=e.coords;U(e=>({...e,[t]:{lat:a,lng:o}})),es(t,`${a},${o}`)},e=>{console.error("Error getting location:",e),alert("Unable to get current location. Please enter coordinates manually.")}):alert("Geolocation is not supported by this browser."))},size:"sm",className:"bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium flex-shrink-0",children:(0,t.jsx)(g.MapPin,{className:"h-4 w-4"})})]}),z[e.fieldId]&&(0,t.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-green-800",children:[(0,t.jsx)("strong",{children:"Current Location:"})," ",z[e.fieldId].lat.toFixed(6),","," ",z[e.fieldId].lng.toFixed(6)]})})]}),"calculation"===e.dataType&&(0,t.jsx)(m.Input,{type:"text",value:void 0!==P[e.fieldId]?"number"==typeof P[e.fieldId]?P[e.fieldId].toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}):P[e.fieldId]:"Calculated automatically",className:"h-10 border-[#EDEEF0] bg-[#F8F8F8] text-[#013A65] font-medium",readOnly:!0,placeholder:"This field is calculated automatically"}),"camera"===e.dataType&&(0,t.jsxs)("div",{className:"space-y-3",children:[!M[e.fieldId]&&(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsxs)(c.Button,{type:"button",onClick:()=>ec(e.fieldId),className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium",children:[(0,t.jsx)(y,{className:"h-4 w-4 mr-2"}),"Take Photo"]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:t=>eu(e.fieldId,t.target.files?.[0]||null),className:"hidden",id:`file-${e.fieldId}`}),(0,t.jsxs)("label",{htmlFor:`file-${e.fieldId}`,className:"flex items-center justify-center w-full h-10 bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-3 text-sm font-medium rounded-lg cursor-pointer",children:[(0,t.jsx)(x.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]})]})]}),M[e.fieldId]&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:M[e.fieldId].preview||"",alt:"Captured photo",className:"w-full h-48 object-cover rounded-lg border border-[#EDEEF0]"}),(0,t.jsx)(c.Button,{type:"button",onClick:()=>ep(e.fieldId),size:"sm",className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white border-0 shadow-lg h-8 w-8 p-0",children:(0,t.jsx)(w.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsxs)(c.Button,{type:"button",onClick:()=>{ep(e.fieldId),ec(e.fieldId)},className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium",children:[(0,t.jsx)(y,{className:"h-4 w-4 mr-2"}),"Retake"]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:t=>{ep(e.fieldId),eu(e.fieldId,t.target.files?.[0]||null)},className:"hidden",id:`replace-file-${e.fieldId}`}),(0,t.jsxs)("label",{htmlFor:`replace-file-${e.fieldId}`,className:"flex items-center justify-center w-full h-10 bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-3 text-sm font-medium rounded-lg cursor-pointer",children:[(0,t.jsx)(x.Upload,{className:"h-4 w-4 mr-2"}),"Replace"]})]})]})]})]}),R[e.fieldId]&&(0,t.jsxs)("p",{className:"text-red-500 text-sm flex items-center",children:[(0,t.jsx)("span",{className:"mr-1",children:"⚠️"}),R[e.fieldId]]})]},e.fieldId))})})]},e)),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 pt-6",children:[(0,t.jsx)(c.Button,{type:"button",onClick:()=>b.push("/dashboard/work"),className:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Cancel"}),(0,t.jsx)(c.Button,{type:"submit",disabled:L||!k||!F,className:"bg-[#013A65] hover:bg-[#013A65]/90 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Creating Work..."]}):"Create Work"})]})]}),X&&K&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-[#013A65] to-[#013A65]/90 text-white p-4 flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Take Photo"}),(0,t.jsx)(c.Button,{type:"button",onClick:()=>em(K),size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-0 h-8 w-8 p-0",children:(0,t.jsx)(w.X,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[(0,t.jsx)("video",{ref:Z,autoPlay:!0,playsInline:!0,className:"w-full h-80 object-cover"}),(0,t.jsx)("canvas",{ref:Q,className:"hidden"}),!H[K]&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,t.jsx)("div",{className:"text-white text-lg",children:"Loading camera..."})})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsxs)(c.Button,{type:"button",onClick:()=>(e=>{if(console.log("[v0] Capturing photo for field:",e),!Z.current||!Q.current){console.error("[v0] Video or canvas ref not available"),alert("Camera not ready. Please try again.");return}let t=Q.current,a=Z.current,o=t.getContext("2d");if(!o){console.error("[v0] Canvas context not available"),alert("Unable to capture photo. Please try again.");return}if(0===a.videoWidth||0===a.videoHeight||a.readyState<2){console.error("[v0] Video not ready, dimensions:",a.videoWidth,"x",a.videoHeight,"readyState:",a.readyState),alert("Camera is still loading. Please wait a moment and try again.");return}console.log("[v0] Video dimensions:",a.videoWidth,"x",a.videoHeight),t.width=a.videoWidth,t.height=a.videoHeight,o.drawImage(a,0,0,t.width,t.height),console.log("[v0] Image drawn to canvas"),t.toBlob(a=>{if(a){console.log("[v0] Photo captured, blob size:",a.size);let o=new File([a],`photo-${Date.now()}.jpg`,{type:"image/jpeg"}),r=t.toDataURL("image/jpeg",.8);V(t=>({...t,[e]:{file:o,preview:r}})),es(e,o),em(e),console.log("[v0] Photo saved and camera stopped")}else console.error("[v0] Failed to create blob from canvas"),alert("Failed to capture photo. Please try again.")},"image/jpeg",.8)})(K),disabled:!H[K],className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-12 px-4 text-base font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,t.jsx)(y,{className:"h-5 w-5 mr-2"}),"Capture Photo"]}),(0,t.jsxs)(c.Button,{type:"button",onClick:()=>em(K),className:"bg-gray-500 hover:bg-gray-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-12 px-4 text-base font-medium",children:[(0,t.jsx)(w.X,{className:"h-5 w-5 mr-2"}),"Cancel"]})]})]})]})}),f&&(0,t.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(h.Loader2,{className:"h-12 w-12 animate-spin text-[#013A65] mx-auto"}),(0,t.jsx)("span",{className:"mt-4 block text-[#013A65]/70",children:"Loading form..."})]})}),F&&0===C.length&&!f&&(0,t.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:[(0,t.jsx)("div",{className:"text-yellow-600 text-4xl mb-4",children:"📋"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-yellow-800 mb-2",children:"No Fields Available"}),(0,t.jsx)("p",{className:"text-yellow-700",children:"No fields found for the selected component. Please choose a different component or contact your administrator."})]})]})}e.s(["CreateWorkForm",()=>b],16096)},12034,e=>{e.v(t=>Promise.all(["static/chunks/1ba5b85bffd2992a.js"].map(t=>e.l(t))).then(()=>t(46169)))}]);