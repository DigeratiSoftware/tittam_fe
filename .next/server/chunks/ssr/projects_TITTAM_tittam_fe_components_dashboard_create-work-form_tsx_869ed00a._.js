module.exports=[78070,a=>{"use strict";var b=a.i(23413),c=a.i(32496),d=a.i(45521),e=a.i(32219),f=a.i(84313),g=a.i(93507);let h=new class{baseUrl="http://127.0.0.1:4000";async makeRequest(a){try{console.log(`[v0] Making master API request to: ${this.baseUrl}${a}`);let b={"Content-Type":"application/json"},c=g.TokenStorage.getAccessToken(),d=g.TokenStorage.getRefreshToken();c&&(b.Authorization=`Bearer ${c}`),d&&(b["x-refresh-token"]=d);let e=await fetch(`${this.baseUrl}${a}`,{headers:b});if(console.log(`[v0] Master API response status: ${e.status}`),!e.ok)throw Error(`HTTP error! status: ${e.status}`);let f=await e.json();console.log("[v0] Master API response data:",f);let h=[];return h=Array.isArray(f)?f:f.success&&Array.isArray(f.data)||f.data&&Array.isArray(f.data)?f.data:[],console.log("[v0] Processed master API result:",h),h}catch(b){return console.error(`[v0] Failed to fetch ${a}:`,b),[]}}async getZones(){return console.log("[v0] Fetching zones from master API"),this.makeRequest("/api/v1/zones")}async getDistricts(a){console.log(`[v0] Fetching districts from master API, zoneId: ${a}`);let b=a?`/api/v1/districts/zone/${a}`:"/api/v1/districts";return this.makeRequest(b)}async getTownPanchayats(a){console.log(`[v0] Fetching town panchayats from master API, districtId: ${a}`);let b=a?`/api/v1/town-panchayats/district/${a}`:"/api/v1/town-panchayats";return this.makeRequest(b)}async getWards(a){console.log(`[v0] Fetching wards from master API, townPanchayatId: ${a}`);let b=a?`/api/v1/wards/townPanchayat/${a}`:"/api/v1/wards";return this.makeRequest(b)}async getAgencies(){return this.makeRequest("/api/lov/agencies")}async getRoadTypesEnglish(){return this.makeRequest("/api/lov/roadTypesEnglish")}async getRoadTypesTamil(){return this.makeRequest("/api/lov/roadTypesTamil")}async getDurationUnits(){return this.makeRequest("/api/lov/durationUnits")}async getStages(){return this.makeRequest("/api/lov/stages")}async getContractors(){return this.makeRequest("/api/lov/contractors")}async getContractorNames(a){let b=a?`/api/lov/contractorNames?gstNo=${a}`:"/api/lov/contractorNames";return this.makeRequest(b)}};var i=a.i(93663),j=a.i(31482),k=a.i(6765),l=a.i(70663),m=a.i(24224),n=a.i(70488),o=a.i(83231),p=a.i(1039),q=a.i(21039);let r=(0,q.default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),s=(0,q.default)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var t=a.i(94328),u=a.i(87324);function v(){let{user:g,isLoading:q}=(0,i.useAuth)(),v=(0,j.useRouter)(),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)({}),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)({}),[M,N]=(0,c.useState)({}),[O,P]=(0,c.useState)({}),[Q,R]=(0,c.useState)({}),[S,T]=(0,c.useState)({}),[U,V]=(0,c.useState)({}),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),$=(0,c.useRef)(null),_=(0,c.useRef)(null),aa=(0,c.useRef)(null);(0,c.useEffect)(()=>{!q&&g&&(ab(),ac())},[q,g]),(0,c.useEffect)(()=>{E&&(ad(E),H({}),N({}))},[E]);let ab=async()=>{try{console.log("[v0] Loading schemes using scheme service");let a=await d.schemeService.getAllSchemes();x(a),console.log("[v0] Loaded schemes:",a.length)}catch(a){console.error("Failed to load schemes:",a),x([])}},ac=async()=>{try{console.log("[v0] Loading components using component service");let a=await e.componentService.getAllComponents();z(a),console.log("[v0] Loaded components:",a.length)}catch(a){console.error("Failed to load components:",a),z([])}},ad=async a=>{try{console.log("[v0] Loading fields for component:",a);let b=await f.templateService.getFieldsByComponent(a);console.log("[v0] Raw API response:",JSON.stringify(b,null,2));let c=[];Array.isArray(b)?(console.log("[v0] Response is direct array, mapping fields..."),c=b.map((a,b)=>(console.log(`[v0] Field ${b}: ${a.name}, options:`,a.options),{...a,fieldId:a.id||a._id||a.fieldId,_id:a.id||a._id,options:a.options||[]}))):b&&b.success&&Array.isArray(b.data)&&(console.log("[v0] Response has nested data array, mapping fields..."),c=b.data.map((a,b)=>(console.log(`[v0] Field ${b}: ${a.name}, options:`,a.options),{...a,fieldId:a.id||a._id||a.fieldId,_id:a.id||a._id,options:a.options||[]}))),console.log("[v0] Fields after mapping:"),c.forEach((a,b)=>{"dropdown"===a.dataType&&console.log(`[v0] Dropdown field ${a.name}:`,{hasLOV:!!a.lov,lovAPI:a.lov?.api,hasOptions:!!(a.options&&Array.isArray(a.options)&&a.options.length>0),optionsLength:a.options?.length||0,sampleOptions:a.options?.slice(0,2)})}),c.sort((a,b)=>a.order-b.order),B(c),console.log("[v0] Fields with LOV configurations:",c.filter(a=>a.lov).map(a=>({name:a.name,lov:a.lov}))),console.log("[v0] Fields with static options:",c.filter(a=>a.options&&Array.isArray(a.options)&&a.options.length>0).map(a=>({name:a.name,optionsCount:a.options?.length||0,sampleOptions:a.options?.slice(0,2)}))),ae(c),console.log("[v0] Loaded fields:",c.length)}catch(a){console.error("Failed to load fields:",a),B([])}},ae=async a=>{let b={};for(let c of(console.log(`[v0] Starting loadDropdownOptions with ${a.length} fields`),a))if(console.log(`[v0] Processing field: ${c.name}, dataType: ${c.dataType}, hasLOV: ${!!c.lov}, LOV API: ${c.lov?.api||"none"}, hasStaticOptions: ${!!(c.options&&Array.isArray(c.options)&&c.options.length>0)}, optionsLength: ${c.options?.length||0}`),c.options&&Array.isArray(c.options)&&c.options.length>0)console.log(`[v0] Using static options for field: ${c.name}, options:`,c.options),b[c.fieldId]=c.options.map((a,b)=>"object"==typeof a&&(a.englishName||a.tamilName||a.nameEnglish||a.nameTamil)?{...a,id:a.id||a.englishName||a.nameEnglish||`option-${b}`,value:a.englishName||a.nameEnglish||a.value||`option-${b}`,nameEnglish:a.englishName||a.nameEnglish||a.value||`option-${b}`,nameTamil:a.tamilName||a.nameTamil||"",englishName:a.englishName||a.nameEnglish||a.value||`option-${b}`,tamilName:a.tamilName||a.nameTamil||""}:"string"==typeof a?{nameEnglish:a,nameTamil:"",englishName:a,tamilName:"",id:a,value:a}:{nameEnglish:String(a),nameTamil:"",englishName:String(a),tamilName:"",id:String(a),value:String(a)}),console.log(`[v0] Mapped ${b[c.fieldId].length} static options for ${c.name}:`,b[c.fieldId]);else if(c.lov&&c.lov.api&&"dropdown"===c.dataType)if(c.name.toLowerCase().includes("zone")||c.name.toLowerCase().includes("district")||c.name.toLowerCase().includes("town")||c.name.toLowerCase().includes("panchayat")||c.name.toLowerCase().includes("ward"))try{let a=[];console.log(`[v0] Loading dropdown options for field: ${c.name}, API: ${c.lov.api}`),c.lov.api.includes("zones")||c.name.toLowerCase().includes("zone")?(console.log(`[v0] Calling zones API for field: ${c.name}`),a=await h.getZones()):c.lov.api.includes("districts")||c.name.toLowerCase().includes("district")?c.lov.dependentOn||(console.log(`[v0] Calling districts API for field: ${c.name}`),a=await h.getDistricts()):c.lov.api.includes("townPanchayats")||c.name.toLowerCase().includes("town")||c.name.toLowerCase().includes("panchayat")?c.lov.dependentOn||(console.log(`[v0] Calling town panchayats API for field: ${c.name}`),a=await h.getTownPanchayats()):(c.lov.api.includes("wards")||c.name.toLowerCase().includes("ward"))&&!c.lov.dependentOn&&(console.log(`[v0] Calling wards API for field: ${c.name}`),a=await h.getWards()),console.log(`[v0] Loaded ${a.length} options for ${c.name}:`,a.slice(0,3)),b[c.fieldId]=a}catch(a){console.error(`[v0] Failed to load options for ${c.name}:`,a),b[c.fieldId]=[]}else console.warn(`[v0] Non-geographic dropdown field ${c.name} has LOV API ${c.lov.api} but no static options - using empty array`),b[c.fieldId]=[];else"dropdown"===c.dataType&&(console.log(`[v0] Dropdown field ${c.name} has no LOV configuration or static options`),b[c.fieldId]=[]);console.log("[v0] All dropdown options loaded:",Object.keys(b).map(a=>({fieldId:a,optionsCount:b[a].length}))),N(b)},af=async(a,b)=>{if(!b||"string"==typeof b&&""===b.trim()||""===b)return void console.log("[v0] Parent value is empty, skipping dependent options load");let c=A.filter(b=>b.lov?.dependentOn===a);for(let d of(console.log(`[v0] Loading dependent options for parent: ${a}, value: ${b}`),console.log(`[v0] Found ${c.length} dependent fields:`,c.map(a=>a.name)),c))try{let a=[];switch(d.lov?.api){case"/api/lov/districts":case"/api/v1/districts":console.log(`[v0] Loading districts for zone: ${b}`),a=await h.getDistricts(b);break;case"/api/lov/town-panchayats":case"/api/v1/town-panchayats":console.log(`[v0] Loading town panchayats for district: ${b}`),a=await h.getTownPanchayats(b);break;case"/api/lov/wards":case"/api/v1/wards":console.log(`[v0] Loading wards for town panchayat: ${b}`),a=await h.getWards(b);break;case"/api/lov/contractorNames":console.log(`[v0] Loading contractor names for GST: ${b}`),a=await h.getContractorNames(b);break;default:console.warn(`[v0] No dependent loading logic for API: ${d.lov?.api}`),d.name.toLowerCase().includes("district")?(console.log(`[v0] Inferring districts API call for field: ${d.name}`),a=await h.getDistricts(b)):d.name.toLowerCase().includes("town")||d.name.toLowerCase().includes("panchayat")?(console.log(`[v0] Inferring town panchayats API call for field: ${d.name}`),a=await h.getTownPanchayats(b)):d.name.toLowerCase().includes("ward")&&(console.log(`[v0] Inferring wards API call for field: ${d.name}`),a=await h.getWards(b))}console.log(`[v0] Loaded ${a.length} dependent options for ${d.name}:`,a),N(b=>({...b,[d.fieldId]:a})),H(a=>{let b={...a};return delete b[d.fieldId],b})}catch(a){console.error(`[v0] Failed to load dependent options for ${d.name}:`,a),N(a=>({...a,[d.fieldId]:[]}))}},ag=async(a,b)=>{console.log(`[v0] Field changed: ${a} = ${b}`),H(c=>{let d={...c,[a]:b},e=A.find(b=>b.fieldId===a);if(e){if(console.log(`[v0] Field found: ${e.name}, checking for dependents`),A.filter(a=>"calculation"===a.dataType).forEach(a=>{let b=ai(a,d);null!=b&&(console.log(`[v0] Calculated value for ${a.name}: ${b}`),d[a.fieldId]=b)}),e.name.toLowerCase().includes("english")&&e.name.toLowerCase().includes("type")){let c=e.name.replace(/english/i,"Tamil").replace(/English/i,"Tamil"),f=A.find(a=>a.name===c);if(f){let c=(M[a]||[]).find(a=>String(a.englishName||a.nameEnglish||a.name||a.value||a.id||String(a))===String(b));if(c&&(c.tamilName||c.nameTamil)){let a=c.tamilName||c.nameTamil;console.log(`[v0] Auto-mapping Tamil value for ${f.name}: ${a}`),d[f.fieldId]=a}}}let c=A.filter(a=>a.lov?.dependentOn===e.name);console.log(`[v0] Found ${c.length} dependent fields to clear`),c.forEach(a=>{console.log(`[v0] Clearing dependent field: ${a.name}`),delete d[a.fieldId],N(b=>({...b,[a.fieldId]:[]}))});let f=null!=b&&""!==b,g="string"==typeof b&&""!==b.trim(),h="string"!=typeof b&&""!==b;if(f&&(g||h)){let d=(M[a]||[]).find(a=>String(a.zoneId||a.districtId||a.tpId||a.townPanchayatId||a.wardId||a.id||a.value||a._id)===String(b)),f=b;if(d&&(e.name.toLowerCase().includes("zone")?f=d.zoneId||b:e.name.toLowerCase().includes("district")?f=d.districtId||b:(e.name.toLowerCase().includes("town")||e.name.toLowerCase().includes("panchayat"))&&(f=d.tpId||d.townPanchayatId||b),console.log(`[v0] Extracted dependent value for ${e.name}: ${f} (from option:`,d,")")),d){let a=c.map(a=>a.fieldId);H(b=>({...b,...a.reduce((a,b)=>({...a,[b]:null}),{})}))}c.forEach(a=>{af(e.name,f)})}}return d})},ah=async b=>{b.preventDefault();let c={};if(A.forEach(a=>{var b;let d,e=(d=!(b=G[a.fieldId])||"string"==typeof b&&""===b.trim()||"string"!=typeof b&&""===b,a.isRequired&&d?`${a.name} is required`:null);e&&(c[a.fieldId]=e)}),L(c),Object.keys(c).length>0)return void console.log("[v0] Form validation failed:",c);J(!0);try{console.log("[v0] Submitting work form:",G);let b=w.find(a=>a.schemeId===C),c=y.find(a=>a.componentId===E);if(!b||!c)throw Error("Selected scheme or component not found");let d={schemeId:C,schemeName:b.englishName,componentId:E,componentName:c.englishName,fieldData:G,createdBy:g?.email||"Unknown User",createdAt:new Date().toISOString()},{workService:e}=await a.A(49996),f=await e.createWork(d);console.log("[v0] Work created successfully:",f),alert("Work created successfully!"),v.push("/dashboard/work")}catch(a){console.error("Failed to create work:",a),alert("Failed to create work. Please try again.")}finally{J(!1)}},ai=(a,b)=>{try{console.log(`[v0] Performing calculation for field: ${a.name}`);let c=a.name.toLowerCase();if(c.includes("balance on fund released")){let a=aj("Fund Released",b),c=aj("Expenditure",b);if(null!==a&&null!==c){let b=a-c;return console.log(`[v0] Balance on Fund Released: ${a} - ${c} = ${b}`),b}}else if(c.includes("balance expenditure on fund released")){let a=aj("Fund Released",b),c=aj("Expenditure",b);if(null!==a&&null!==c){let b=a-c;return console.log(`[v0] Balance Expenditure on fund released: ${a} - ${c} = ${b}`),b}}else if(c.includes("balance expenditure on estimate")){let a=aj("Estimate in Rupees",b),c=aj("Expenditure",b);if(null!==a&&null!==c){let b=a-c;return console.log(`[v0] Balance Expenditure on estimate: ${a} - ${c} = ${b}`),b}}if(a.validation&&a.validation.field1&&a.validation.field2&&a.validation.operator){let c=aj(a.validation.field1,b),d=aj(a.validation.field2,b),e=a.validation.operator;if(null!==c&&null!==d){let a;switch(e){case"+":case"add":a=c+d;break;case"-":case"subtract":a=c-d;break;case"*":case"multiply":a=c*d;break;case"/":case"divide":a=0!==d?c/d:0;break;default:return console.warn(`[v0] Unknown operator: ${e}`),null}return console.log(`[v0] Generic calculation: ${c} ${e} ${d} = ${a}`),a}}return null}catch(b){return console.error(`[v0] Error in calculation for ${a.name}:`,b),null}},aj=(a,b)=>{let c=A.find(b=>b.name===a);if(!c)return console.log(`[v0] Field not found: ${a}`),null;let d=b[c.fieldId],e=Number.parseFloat(d);return isNaN(e)?(console.log(`[v0] Invalid number value for ${a}: ${d}`),null):e},ak=async a=>{try{if(console.log("[v0] Starting camera for field:",a),Z(a),X(!0),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Camera not supported in this browser");console.log("[v0] Requesting camera access...");let b=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});if(console.log("[v0] Camera access granted, stream:",b),aa.current=b,$.current){$.current.srcObject=b,console.log("[v0] Video element set with stream");let c=$.current,d=()=>{console.log("[v0] Video ready, dimensions:",c.videoWidth,"x",c.videoHeight),V(b=>({...b,[a]:!0}))};c.addEventListener("loadedmetadata",d),c.addEventListener("canplay",d),c.readyState>=2&&d()}console.log("[v0] Camera modal opened for field:",a)}catch(b){console.error("[v0] Error accessing camera:",b),X(!1),Z(null);let a="Unable to access camera. ";b instanceof Error&&("NotAllowedError"===b.name?a+="Camera permission denied. Please allow camera access and try again.":"NotFoundError"===b.name?a+="No camera found on this device.":"NotSupportedError"===b.name?a+="Camera not supported in this browser.":a+=b.message),alert(a+" Please use file upload instead.")}},al=a=>{console.log("[v0] Stopping camera for field:",a),aa.current&&(aa.current.getTracks().forEach(a=>{console.log("[v0] Stopping track:",a.kind,a.label),a.stop()}),aa.current=null),X(!1),Z(null),V(b=>({...b,[a]:!1}))},am=(a,b)=>{if(b){let c=URL.createObjectURL(b);R(d=>({...d,[a]:{file:b,preview:c}})),ag(a,b)}},an=a=>{let b=Q[a];b?.preview&&URL.revokeObjectURL(b.preview),R(b=>{let c={...b};return delete c[a],c}),ag(a,null)};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"bg-gradient-to-r from-[#013A65] via-[#0056A3] to-[#013A65] rounded-lg py-3 px-6 text-white shadow-lg border border-[#F3B335]/20",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-white",children:"Create Work"}),(0,b.jsx)("p",{className:"text-white/90 text-sm mt-1",children:"Create a new work entry with dynamic fields based on selected scheme and component"})]}),(0,b.jsxs)(k.Button,{onClick:()=>v.push("/dashboard/work"),size:"sm",className:"bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-9 px-4 text-sm font-medium",children:[(0,b.jsx)(r,{className:"h-4 w-4 mr-1.5"}),"Back to Work List"]})]})}),(0,b.jsx)("div",{className:"bg-white rounded-lg border border-[#F3B335]/20 shadow-sm p-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:["Select Scheme ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(m.Select,{value:C,onValueChange:D,children:[(0,b.jsx)(m.SelectTrigger,{className:"h-12 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white text-base w-full",children:(0,b.jsx)(m.SelectValue,{placeholder:"Choose a scheme..."})}),(0,b.jsx)(m.SelectContent,{children:w.map(a=>(0,b.jsx)(m.SelectItem,{value:a.schemeId,children:a.englishName},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:["Select Component ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(m.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(m.SelectTrigger,{className:"h-12 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white text-base w-full",children:(0,b.jsx)(m.SelectValue,{placeholder:"Choose a component..."})}),(0,b.jsx)(m.SelectContent,{children:y.map(a=>(0,b.jsx)(m.SelectItem,{value:a.componentId,children:a.englishName},a.id))})]})]})]})}),A.length>0&&(0,b.jsxs)("form",{onSubmit:ah,className:"space-y-6",children:[Object.entries(A.reduce((a,b)=>{let c=b.group||"General";return a[c]||(a[c]=[]),a[c].push(b),a},{})).map(([a,c])=>(0,b.jsxs)("div",{className:"flex flex-col h-full bg-white rounded-lg border border-[#F3B335]/20 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"flex-shrink-0 p-4 border-b border-[#F3B335]/20",children:(0,b.jsx)("div",{className:"bg-[#F3B335] rounded-lg p-2 w-full",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-[#013A65]",children:a})})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map(a=>(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-[#013A65]",children:[a.name,a.isRequired&&(0,b.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"dropdown"===a.dataType&&(0,b.jsxs)(m.Select,{value:G[a.fieldId]||"",onValueChange:b=>ag(a.fieldId,b),children:[(0,b.jsx)(m.SelectTrigger,{className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",children:(0,b.jsx)(m.SelectValue,{placeholder:`Select ${a.name}`})}),(0,b.jsx)(m.SelectContent,{children:(M[a.fieldId]||[]).map((a,c)=>{let d=a.zoneId||a.districtId||a.tpId||a.townPanchayatId||a.wardId||a.id||a.value||a._id||a,e=a.englishName||a.nameEnglish||a.name||a.label||a.value||String(a);return(0,b.jsx)(m.SelectItem,{value:String(d),children:String(e)},`${d}-${c}`)})})]}),"text"===a.dataType&&(0,b.jsx)(l.Input,{type:"text",value:G[a.fieldId]||"",onChange:b=>ag(a.fieldId,b.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:a.isRequired,placeholder:`Enter ${a.name}`}),"number"===a.dataType&&(0,b.jsx)(l.Input,{type:"number",value:G[a.fieldId]||"",onChange:b=>ag(a.fieldId,b.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:a.isRequired,placeholder:`Enter ${a.name}`}),"date"===a.dataType&&(0,b.jsx)(l.Input,{type:"date",value:G[a.fieldId]||"",onChange:b=>ag(a.fieldId,b.target.value),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",required:a.isRequired}),"financialYearPicker"===a.dataType&&(0,b.jsxs)(m.Select,{value:G[a.fieldId]||"",onValueChange:b=>ag(a.fieldId,b),children:[(0,b.jsx)(m.SelectTrigger,{className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white w-full",children:(0,b.jsx)(m.SelectValue,{placeholder:"Select Financial Year"})}),(0,b.jsx)(m.SelectContent,{children:(()=>{let a=new Date().getFullYear(),b=[];for(let c=a-4;c<=a;c++)b.push({value:`${c}-${c+1}`,label:`${c}-${c+1}`});return b})().map(a=>(0,b.jsx)(m.SelectItem,{value:a.value,children:a.label},a.value))})]}),"boolean"===a.dataType&&(0,b.jsxs)("div",{className:"flex items-center space-x-3 p-3 border border-[#EDEEF0] rounded-lg bg-[#F8F8F8]",children:[(0,b.jsx)(n.Checkbox,{checked:G[a.fieldId]||!1,onCheckedChange:b=>ag(a.fieldId,b),className:"border-[#EDEEF0] data-[state=checked]:bg-[#013A65] data-[state=checked]:border-[#013A65]"}),(0,b.jsx)("span",{className:"text-sm text-[#013A65]",children:"Yes / Enabled"})]}),"textarea"===a.dataType&&(0,b.jsx)("textarea",{value:G[a.fieldId]||"",onChange:b=>ag(a.fieldId,b.target.value),className:"min-h-[80px] w-full px-3 py-2 border border-[#EDEEF0] rounded-lg focus:border-[#013A65] focus:ring-[#013A65]/20 focus:outline-none bg-white resize-vertical",required:a.isRequired,placeholder:`Enter ${a.name}`,rows:3}),"file"===a.dataType&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Input,{type:"file",onChange:b=>ag(a.fieldId,b.target.files?.[0]),className:"h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-[#F3B335]/10 file:text-[#013A65] hover:file:bg-[#F3B335]/20",required:a.isRequired}),(0,b.jsx)("p",{className:"text-xs text-[#013A65]/60",children:"Supported formats: PDF, DOC, DOCX, JPG, PNG (Max: 10MB)"})]}),"geoLocation"===a.dataType&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(l.Input,{type:"text",value:G[a.fieldId]||"",onChange:b=>ag(a.fieldId,b.target.value),className:"flex-1 h-10 border-[#EDEEF0] focus:border-[#013A65] focus:ring-[#013A65]/20 bg-white",placeholder:"Latitude, Longitude (e.g., 12.9716, 77.5946)",required:a.isRequired}),(0,b.jsx)(k.Button,{type:"button",onClick:()=>{var b;return b=a.fieldId,void(navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{let{latitude:c,longitude:d}=a.coords;P(a=>({...a,[b]:{lat:c,lng:d}})),ag(b,`${c},${d}`)},a=>{console.error("Error getting location:",a),alert("Unable to get current location. Please enter coordinates manually.")}):alert("Geolocation is not supported by this browser."))},size:"sm",className:"bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium flex-shrink-0",children:(0,b.jsx)(p.MapPin,{className:"h-4 w-4"})})]}),O[a.fieldId]&&(0,b.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-green-800",children:[(0,b.jsx)("strong",{children:"Current Location:"})," ",O[a.fieldId].lat.toFixed(6),","," ",O[a.fieldId].lng.toFixed(6)]})})]}),"calculation"===a.dataType&&(0,b.jsx)(l.Input,{type:"text",value:void 0!==G[a.fieldId]?"number"==typeof G[a.fieldId]?G[a.fieldId].toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}):G[a.fieldId]:"Calculated automatically",className:"h-10 border-[#EDEEF0] bg-[#F8F8F8] text-[#013A65] font-medium",readOnly:!0,placeholder:"This field is calculated automatically"}),"camera"===a.dataType&&(0,b.jsxs)("div",{className:"space-y-3",children:[!Q[a.fieldId]&&(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsxs)(k.Button,{type:"button",onClick:()=>ak(a.fieldId),className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium",children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-2"}),"Take Photo"]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:b=>am(a.fieldId,b.target.files?.[0]||null),className:"hidden",id:`file-${a.fieldId}`}),(0,b.jsxs)("label",{htmlFor:`file-${a.fieldId}`,className:"flex items-center justify-center w-full h-10 bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-3 text-sm font-medium rounded-lg cursor-pointer",children:[(0,b.jsx)(t.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]})]})]}),Q[a.fieldId]&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:Q[a.fieldId].preview||"",alt:"Captured photo",className:"w-full h-48 object-cover rounded-lg border border-[#EDEEF0]"}),(0,b.jsx)(k.Button,{type:"button",onClick:()=>an(a.fieldId),size:"sm",className:"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white border-0 shadow-lg h-8 w-8 p-0",children:(0,b.jsx)(u.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsxs)(k.Button,{type:"button",onClick:()=>{an(a.fieldId),ak(a.fieldId)},className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-10 px-3 text-sm font-medium",children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-2"}),"Retake"]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:b=>{an(a.fieldId),am(a.fieldId,b.target.files?.[0]||null)},className:"hidden",id:`replace-file-${a.fieldId}`}),(0,b.jsxs)("label",{htmlFor:`replace-file-${a.fieldId}`,className:"flex items-center justify-center w-full h-10 bg-gradient-to-r from-[#F3B335] to-[#F3B335]/90 hover:from-[#F3B335]/90 hover:to-[#F3B335]/80 text-[#013A65] border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-3 text-sm font-medium rounded-lg cursor-pointer",children:[(0,b.jsx)(t.Upload,{className:"h-4 w-4 mr-2"}),"Replace"]})]})]})]})]}),K[a.fieldId]&&(0,b.jsxs)("p",{className:"text-red-500 text-sm flex items-center",children:[(0,b.jsx)("span",{className:"mr-1",children:"âš ï¸"}),K[a.fieldId]]})]},a.fieldId))})})]},a)),(0,b.jsxs)("div",{className:"flex justify-end space-x-4 pt-6",children:[(0,b.jsx)(k.Button,{type:"button",onClick:()=>v.push("/dashboard/work"),className:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors",children:"Cancel"}),(0,b.jsx)(k.Button,{type:"submit",disabled:I||!C||!E,className:"bg-[#013A65] hover:bg-[#013A65]/90 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Creating Work..."]}):"Create Work"})]})]}),W&&Y&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-[#013A65] to-[#013A65]/90 text-white p-4 flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Take Photo"}),(0,b.jsx)(k.Button,{type:"button",onClick:()=>al(Y),size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-0 h-8 w-8 p-0",children:(0,b.jsx)(u.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden",children:[(0,b.jsx)("video",{ref:$,autoPlay:!0,playsInline:!0,className:"w-full h-80 object-cover"}),(0,b.jsx)("canvas",{ref:_,className:"hidden"}),!U[Y]&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,b.jsx)("div",{className:"text-white text-lg",children:"Loading camera..."})})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsxs)(k.Button,{type:"button",onClick:()=>(a=>{if(console.log("[v0] Capturing photo for field:",a),!$.current||!_.current){console.error("[v0] Video or canvas ref not available"),alert("Camera not ready. Please try again.");return}let b=_.current,c=$.current,d=b.getContext("2d");if(!d){console.error("[v0] Canvas context not available"),alert("Unable to capture photo. Please try again.");return}if(0===c.videoWidth||0===c.videoHeight||c.readyState<2){console.error("[v0] Video not ready, dimensions:",c.videoWidth,"x",c.videoHeight,"readyState:",c.readyState),alert("Camera is still loading. Please wait a moment and try again.");return}console.log("[v0] Video dimensions:",c.videoWidth,"x",c.videoHeight),b.width=c.videoWidth,b.height=c.videoHeight,d.drawImage(c,0,0,b.width,b.height),console.log("[v0] Image drawn to canvas"),b.toBlob(c=>{if(c){console.log("[v0] Photo captured, blob size:",c.size);let d=new File([c],`photo-${Date.now()}.jpg`,{type:"image/jpeg"}),e=b.toDataURL("image/jpeg",.8);R(b=>({...b,[a]:{file:d,preview:e}})),ag(a,d),al(a),console.log("[v0] Photo saved and camera stopped")}else console.error("[v0] Failed to create blob from canvas"),alert("Failed to capture photo. Please try again.")},"image/jpeg",.8)})(Y),disabled:!U[Y],className:"flex-1 bg-gradient-to-r from-[#013A65] to-[#013A65]/90 hover:from-[#013A65]/90 hover:to-[#013A65]/80 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-12 px-4 text-base font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,b.jsx)(s,{className:"h-5 w-5 mr-2"}),"Capture Photo"]}),(0,b.jsxs)(k.Button,{type:"button",onClick:()=>al(Y),className:"bg-gray-500 hover:bg-gray-600 text-white border-0 shadow-lg hover:shadow-xl transition-all duration-300 h-12 px-4 text-base font-medium",children:[(0,b.jsx)(u.X,{className:"h-5 w-5 mr-2"}),"Cancel"]})]})]})]})}),q&&(0,b.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(o.Loader2,{className:"h-12 w-12 animate-spin text-[#013A65] mx-auto"}),(0,b.jsx)("span",{className:"mt-4 block text-[#013A65]/70",children:"Loading form..."})]})}),E&&0===A.length&&!q&&(0,b.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center",children:[(0,b.jsx)("div",{className:"text-yellow-600 text-4xl mb-4",children:"ðŸ“‹"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-yellow-800 mb-2",children:"No Fields Available"}),(0,b.jsx)("p",{className:"text-yellow-700",children:"No fields found for the selected component. Please choose a different component or contact your administrator."})]})]})}a.s(["CreateWorkForm",()=>v],78070)}];

//# sourceMappingURL=projects_TITTAM_tittam_fe_components_dashboard_create-work-form_tsx_869ed00a._.js.map